# コスト最適化ガイド

## 💰 v5: コスト最適化版の特徴

### モデルの使い分け

| 用途 | モデル | 理由 | 相対コスト |
|------|--------|------|------------|
| コメント要約 | Claude Haiku | 大量テキストの要約に最適 | 💵 |
| メイン分析 | Claude Sonnet | 高品質な分析が必要 | 💵💵💵💵 |
| 技術分析 | Gemini Flash | 高速で安価 | 💵 |
| UX分析 | GPT-3.5 | 十分な品質で安価 | 💵 |
| 統合 | Claude Haiku | シンプルなタスク | 💵 |

### コスト削減の仕組み

1. **前処理で圧縮**
   ```
   30件のコメント (10,000トークン)
   ↓ Claude Haiku で要約
   要約 (1,000トークン)
   ```
   → 高価なモデルへの入力を90%削減

2. **適材適所**
   - 複雑な分析 → 高性能モデル
   - 単純な処理 → 安価なモデル

3. **並列処理なし**
   - API制限を避ける
   - 順次実行でコスト管理

## 📊 コスト比較

### 従来版（v3/v4）
```
全て高性能モデル使用:
- Claude Sonnet × 3回
- GPT-4 × 1回
- Gemini Pro × 1回
推定コスト: $0.15～0.30/分析
```

### 最適化版（v5）
```
適切なモデル選択:
- Claude Haiku × 2回（要約・統合）
- Claude Sonnet × 1回（メイン）
- GPT-3.5 × 1回
- Gemini Flash × 1回
推定コスト: $0.03～0.08/分析
```

**約70%のコスト削減！**

## 🎯 使用シーン別推奨

### 大量のコメントがあるIssue
→ **v5を推奨**（要約機能でコスト効率UP）

### シンプルなIssue
→ **v3で十分**（処理が早い）

### 詳細な技術分析が必要
→ **v4を推奨**（全コメント分析）

### 予算制限がある
→ **v5一択**

## ⚙️ カスタマイズ

### モデル変更
```python
# より安価にしたい場合
model="claude-3-haiku-20240307"  # Sonnetの代わりに
model="gpt-3.5-turbo-16k"        # より多くのコンテキスト

# より高品質にしたい場合  
model="gpt-4"                    # GPT-3.5の代わりに
model="gemini-1.5-pro"           # Gemini Flashの代わりに
```

### トークン制限
```python
max_tokens=500   # 要約を短くしてコスト削減
max_tokens=3000  # より詳細な分析
```

## 📈 コスト監視

定期的にAPIダッシュボードで確認：
- [Anthropic Console](https://console.anthropic.com)
- [OpenAI Usage](https://platform.openai.com/usage)
- [Google AI Studio](https://makersuite.google.com)

## 🚨 注意事項

1. **品質とのトレードオフ**
   - 安価なモデルは品質が劣る場合あり
   - 重要な分析は高性能モデルを使用

2. **レート制限**
   - 安価なモデルほど制限が厳しい
   - 適切な間隔で実行

3. **キャッシュ活用**
   - 同じIssueの再分析は避ける
   - 必要な時だけ実行